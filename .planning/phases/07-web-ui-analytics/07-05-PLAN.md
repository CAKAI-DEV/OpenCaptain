---
phase: 07-web-ui-analytics
plan: 05
type: execute
wave: 3
depends_on: ["07-03", "07-04"]
files_modified:
  - web/src/app/(dashboard)/projects/[projectId]/list/page.tsx
  - web/src/components/list/task-list.tsx
  - web/src/components/list/task-row.tsx
  - web/src/components/list/task-filters.tsx
  - web/src/components/ui/calendar.tsx
  - web/src/components/ui/popover.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can see tasks in a table/list format"
    - "User can filter tasks by status, priority, and assignee"
    - "User can search tasks by title"
    - "Filters persist in URL (shareable filtered views)"
  artifacts:
    - path: "web/src/app/(dashboard)/projects/[projectId]/list/page.tsx"
      provides: "List view page with filters"
      min_lines: 30
    - path: "web/src/components/list/task-list.tsx"
      provides: "Task list table component"
      exports: ["TaskList"]
    - path: "web/src/components/list/task-filters.tsx"
      provides: "Filter controls (status, priority, assignee, search)"
      exports: ["TaskFilters"]
  key_links:
    - from: "web/src/components/list/task-filters.tsx"
      to: "URL searchParams"
      via: "useSearchParams + router.push"
      pattern: "useSearchParams|searchParams"
    - from: "web/src/app/(dashboard)/projects/[projectId]/list/page.tsx"
      to: "/api/v1/tasks"
      via: "Server-side fetch with query params"
      pattern: "apiClient.*tasks.*projectId"
---

<objective>
Build task list view with filterable table, search, and URL-persisted filter state.

Purpose: Provide an alternative view to Kanban for users who prefer list-based task management with advanced filtering.
Output: Working list view with filters for status/priority/assignee/search, results update based on URL params.
</objective>

<execution_context>
@/Users/dio/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dio/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-web-ui-analytics/07-RESEARCH.md
@.planning/phases/07-web-ui-analytics/07-03-SUMMARY.md
@.planning/phases/07-web-ui-analytics/07-04-SUMMARY.md
@src/features/tasks/tasks.routes.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add additional shadcn/ui components for filters</name>
  <files>
    - web/src/components/ui/calendar.tsx
    - web/src/components/ui/popover.tsx
    - web/src/components/ui/table.tsx
    - web/src/components/ui/checkbox.tsx
  </files>
  <action>
Add shadcn/ui components needed for the list view filters and table.

```bash
cd /Users/dio/RnD/web
npm install date-fns
npx shadcn@latest add calendar popover table checkbox
```

These components will be used for:
- `calendar` + `popover`: Date range filters if needed
- `table`: Task list display
- `checkbox`: Multi-select tasks (future enhancement)
  </action>
  <verify>
```bash
cd /Users/dio/RnD/web
test -f src/components/ui/table.tsx && echo "Table OK"
test -f src/components/ui/popover.tsx && echo "Popover OK"
grep -q "date-fns" package.json && echo "date-fns OK"
```
  </verify>
  <done>shadcn/ui Table, Calendar, Popover, Checkbox components installed</done>
</task>

<task type="auto">
  <name>Task 2: Create task filter components</name>
  <files>
    - web/src/components/list/task-filters.tsx
    - web/src/components/list/search-input.tsx
  </files>
  <action>
Create filter components that update URL search params.

Create web/src/components/list/search-input.tsx:
```typescript
'use client'

import { useCallback, useEffect, useState } from 'react'
import { useRouter, useSearchParams, usePathname } from 'next/navigation'
import { Input } from '@/components/ui/input'
import { Search, X } from 'lucide-react'
import { useDebouncedCallback } from '@/hooks/use-debounced-callback'

export function SearchInput() {
  const router = useRouter()
  const pathname = usePathname()
  const searchParams = useSearchParams()
  const [value, setValue] = useState(searchParams.get('search') ?? '')

  const updateSearch = useDebouncedCallback((term: string) => {
    const params = new URLSearchParams(searchParams.toString())
    if (term) {
      params.set('search', term)
    } else {
      params.delete('search')
    }
    params.delete('page') // Reset to page 1 on search
    router.push(`${pathname}?${params.toString()}`)
  }, 300)

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const newValue = e.target.value
    setValue(newValue)
    updateSearch(newValue)
  }

  const handleClear = () => {
    setValue('')
    updateSearch('')
  }

  return (
    <div className="relative w-64">
      <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
      <Input
        type="text"
        placeholder="Search tasks..."
        value={value}
        onChange={handleChange}
        className="pl-9 pr-8"
      />
      {value && (
        <button
          onClick={handleClear}
          className="absolute right-3 top-1/2 -translate-y-1/2"
        >
          <X className="h-4 w-4 text-muted-foreground hover:text-foreground" />
        </button>
      )}
    </div>
  )
}
```

Create web/src/hooks/use-debounced-callback.ts:
```typescript
import { useCallback, useRef, useEffect } from 'react'

export function useDebouncedCallback<T extends (...args: unknown[]) => void>(
  callback: T,
  delay: number
): T {
  const timeoutRef = useRef<NodeJS.Timeout | null>(null)
  const callbackRef = useRef(callback)

  useEffect(() => {
    callbackRef.current = callback
  }, [callback])

  return useCallback(
    ((...args) => {
      if (timeoutRef.current) {
        clearTimeout(timeoutRef.current)
      }
      timeoutRef.current = setTimeout(() => {
        callbackRef.current(...args)
      }, delay)
    }) as T,
    [delay]
  )
}
```

Create web/src/components/list/task-filters.tsx:
```typescript
'use client'

import { useRouter, useSearchParams, usePathname } from 'next/navigation'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import { Button } from '@/components/ui/button'
import { SearchInput } from './search-input'
import { X } from 'lucide-react'

const STATUS_OPTIONS = [
  { value: 'all', label: 'All Status' },
  { value: 'todo', label: 'To Do' },
  { value: 'in_progress', label: 'In Progress' },
  { value: 'done', label: 'Done' },
]

const PRIORITY_OPTIONS = [
  { value: 'all', label: 'All Priority' },
  { value: 'low', label: 'Low' },
  { value: 'medium', label: 'Medium' },
  { value: 'high', label: 'High' },
  { value: 'urgent', label: 'Urgent' },
]

export function TaskFilters() {
  const router = useRouter()
  const pathname = usePathname()
  const searchParams = useSearchParams()

  const status = searchParams.get('status') ?? 'all'
  const priority = searchParams.get('priority') ?? 'all'
  const hasFilters = status !== 'all' || priority !== 'all' || searchParams.has('search')

  const updateFilter = (key: string, value: string) => {
    const params = new URLSearchParams(searchParams.toString())
    if (value === 'all') {
      params.delete(key)
    } else {
      params.set(key, value)
    }
    params.delete('page') // Reset to page 1 on filter change
    router.push(`${pathname}?${params.toString()}`)
  }

  const clearFilters = () => {
    router.push(pathname)
  }

  return (
    <div className="flex items-center gap-3 flex-wrap">
      <SearchInput />

      <Select value={status} onValueChange={(v) => updateFilter('status', v)}>
        <SelectTrigger className="w-36">
          <SelectValue placeholder="Status" />
        </SelectTrigger>
        <SelectContent>
          {STATUS_OPTIONS.map((opt) => (
            <SelectItem key={opt.value} value={opt.value}>
              {opt.label}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>

      <Select value={priority} onValueChange={(v) => updateFilter('priority', v)}>
        <SelectTrigger className="w-36">
          <SelectValue placeholder="Priority" />
        </SelectTrigger>
        <SelectContent>
          {PRIORITY_OPTIONS.map((opt) => (
            <SelectItem key={opt.value} value={opt.value}>
              {opt.label}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>

      {hasFilters && (
        <Button variant="ghost" size="sm" onClick={clearFilters}>
          <X className="h-4 w-4 mr-1" />
          Clear
        </Button>
      )}
    </div>
  )
}
```
  </action>
  <verify>
```bash
cd /Users/dio/RnD/web
test -f src/components/list/task-filters.tsx && echo "Filters OK"
test -f src/components/list/search-input.tsx && echo "Search OK"
test -f src/hooks/use-debounced-callback.ts && echo "Debounce hook OK"
grep -q "useSearchParams" src/components/list/task-filters.tsx && echo "URL params OK"
```
  </verify>
  <done>TaskFilters component with status/priority dropdowns, SearchInput with debounced URL update, clear filters button</done>
</task>

<task type="auto">
  <name>Task 3: Create task list and list page</name>
  <files>
    - web/src/components/list/task-list.tsx
    - web/src/components/list/task-row.tsx
    - web/src/app/(dashboard)/projects/[projectId]/list/page.tsx
  </files>
  <action>
Create the task list table and the list page that reads filters from URL.

Create web/src/components/list/task-row.tsx:
```typescript
'use client'

import { useRouter } from 'next/navigation'
import { TableCell, TableRow } from '@/components/ui/table'
import { Badge } from '@/components/ui/badge'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import type { Task, TaskStatus, TaskPriority } from '@/types/task'
import { Calendar, User } from 'lucide-react'

interface TaskRowProps {
  task: Task
  onStatusChange: (taskId: string, status: TaskStatus) => void
}

const statusLabels: Record<TaskStatus, string> = {
  todo: 'To Do',
  in_progress: 'In Progress',
  done: 'Done',
}

const priorityColors: Record<TaskPriority, string> = {
  low: 'bg-slate-100 text-slate-700',
  medium: 'bg-blue-100 text-blue-700',
  high: 'bg-orange-100 text-orange-700',
  urgent: 'bg-red-100 text-red-700',
}

export function TaskRow({ task, onStatusChange }: TaskRowProps) {
  const router = useRouter()

  return (
    <TableRow
      className="cursor-pointer hover:bg-muted/50"
      onClick={() => {
        // TODO: Open task detail modal
      }}
    >
      <TableCell className="font-medium max-w-md">
        <div className="truncate">{task.title}</div>
        {task.description && (
          <div className="text-xs text-muted-foreground truncate">
            {task.description}
          </div>
        )}
      </TableCell>
      <TableCell onClick={(e) => e.stopPropagation()}>
        <Select
          value={task.status}
          onValueChange={(value) => onStatusChange(task.id, value as TaskStatus)}
        >
          <SelectTrigger className="w-32 h-8">
            <SelectValue />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="todo">{statusLabels.todo}</SelectItem>
            <SelectItem value="in_progress">{statusLabels.in_progress}</SelectItem>
            <SelectItem value="done">{statusLabels.done}</SelectItem>
          </SelectContent>
        </Select>
      </TableCell>
      <TableCell>
        <Badge variant="secondary" className={priorityColors[task.priority]}>
          {task.priority}
        </Badge>
      </TableCell>
      <TableCell>
        {task.dueDate ? (
          <span className="flex items-center gap-1 text-sm">
            <Calendar className="h-3 w-3" />
            {new Date(task.dueDate).toLocaleDateString()}
          </span>
        ) : (
          <span className="text-muted-foreground">-</span>
        )}
      </TableCell>
      <TableCell>
        {task.assigneeId ? (
          <span className="flex items-center gap-1 text-sm">
            <User className="h-3 w-3" />
            Assigned
          </span>
        ) : (
          <span className="text-muted-foreground">Unassigned</span>
        )}
      </TableCell>
    </TableRow>
  )
}
```

Create web/src/components/list/task-list.tsx:
```typescript
'use client'

import { useOptimisticTasks } from '@/hooks/use-optimistic-tasks'
import {
  Table,
  TableBody,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'
import { TaskRow } from './task-row'
import type { Task, TaskStatus } from '@/types/task'

interface TaskListProps {
  initialTasks: Task[]
}

export function TaskList({ initialTasks }: TaskListProps) {
  const { tasks, updateTask } = useOptimisticTasks(initialTasks)

  const handleStatusChange = (taskId: string, status: TaskStatus) => {
    updateTask(taskId, { status })
  }

  if (tasks.length === 0) {
    return (
      <div className="text-center py-12 text-muted-foreground">
        No tasks found. Try adjusting your filters or create a new task.
      </div>
    )
  }

  return (
    <Table>
      <TableHeader>
        <TableRow>
          <TableHead className="w-[40%]">Title</TableHead>
          <TableHead className="w-[15%]">Status</TableHead>
          <TableHead className="w-[15%]">Priority</TableHead>
          <TableHead className="w-[15%]">Due Date</TableHead>
          <TableHead className="w-[15%]">Assignee</TableHead>
        </TableRow>
      </TableHeader>
      <TableBody>
        {tasks.map((task) => (
          <TaskRow
            key={task.id}
            task={task}
            onStatusChange={handleStatusChange}
          />
        ))}
      </TableBody>
    </Table>
  )
}
```

Create web/src/app/(dashboard)/projects/[projectId]/list/page.tsx:
```typescript
import { Suspense } from 'react'
import { apiClient } from '@/lib/api'
import { TaskFilters } from '@/components/list/task-filters'
import { TaskList } from '@/components/list/task-list'
import { Skeleton } from '@/components/ui/skeleton'
import type { Task } from '@/types/task'
import type { PaginatedResponse } from '@/types/api'

interface ListPageProps {
  params: Promise<{ projectId: string }>
  searchParams: Promise<{
    status?: string
    priority?: string
    search?: string
    page?: string
  }>
}

async function TaskListLoader({
  projectId,
  status,
  priority,
  search,
  page,
}: {
  projectId: string
  status?: string
  priority?: string
  search?: string
  page?: string
}) {
  const params = new URLSearchParams({
    projectId,
    limit: '50',
    parentTaskId: 'null',
  })

  if (status && status !== 'all') params.set('status', status)
  // Note: Backend doesn't support priority/search filters yet
  // For now we filter client-side, but ideally backend would support these

  const response = await apiClient<PaginatedResponse<Task>>(`/tasks?${params}`)

  // Client-side filtering for priority and search (until backend supports)
  let filteredTasks = response.data

  if (priority && priority !== 'all') {
    filteredTasks = filteredTasks.filter((t) => t.priority === priority)
  }

  if (search) {
    const searchLower = search.toLowerCase()
    filteredTasks = filteredTasks.filter(
      (t) =>
        t.title.toLowerCase().includes(searchLower) ||
        t.description?.toLowerCase().includes(searchLower)
    )
  }

  return <TaskList initialTasks={filteredTasks} />
}

export default async function ListPage({ params, searchParams }: ListPageProps) {
  const { projectId } = await params
  const { status, priority, search, page } = await searchParams

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <h1 className="text-2xl font-bold">Tasks</h1>
        {/* TODO: Add create task button */}
      </div>

      <TaskFilters />

      <div className="border rounded-lg">
        <Suspense
          fallback={
            <div className="p-4 space-y-3">
              {[...Array(5)].map((_, i) => (
                <Skeleton key={i} className="h-12 w-full" />
              ))}
            </div>
          }
        >
          <TaskListLoader
            projectId={projectId}
            status={status}
            priority={priority}
            search={search}
            page={page}
          />
        </Suspense>
      </div>
    </div>
  )
}
```
  </action>
  <verify>
```bash
cd /Users/dio/RnD/web
test -f src/components/list/task-list.tsx && echo "TaskList OK"
test -f src/components/list/task-row.tsx && echo "TaskRow OK"
test -f src/app/\\(dashboard\\)/projects/\\[projectId\\]/list/page.tsx && echo "List page OK"
grep -q "searchParams" src/app/\\(dashboard\\)/projects/\\[projectId\\]/list/page.tsx && echo "Params OK"
grep -q "Table" src/components/list/task-list.tsx && echo "Table component OK"
```
  </verify>
  <done>TaskList table with rows, TaskRow with inline status change, list page reads URL filters and fetches tasks</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Navigate to /projects/[id]/list
2. See task table with columns: Title, Status, Priority, Due Date, Assignee
3. Use status dropdown to filter - URL updates, table filters
4. Use priority dropdown - URL updates, table filters
5. Type in search - URL updates after debounce, table filters
6. Copy URL and open in new tab - same filters applied
7. Click "Clear" button - all filters removed
8. Change task status inline - updates optimistically
</verification>

<success_criteria>
- Task list displays in table format with all columns
- Status filter dropdown works (updates URL and results)
- Priority filter dropdown works (updates URL and results)
- Search input filters by title/description with debounce
- Filters persist in URL (shareable)
- Clear button removes all filters
- Status can be changed inline with optimistic update
- Empty state shown when no tasks match filters
</success_criteria>

<output>
After completion, create `.planning/phases/07-web-ui-analytics/07-05-SUMMARY.md`
</output>
